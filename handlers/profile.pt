from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
from keyboards.profile_menu import profile_main_keyboard
from database import Database
from utils.functions import calculate_power

db = Database()
profile_router = Router()

@profile_router.message(F.text == "ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„")
async def profile_main(message: Message):
    user_id = message.from_user.id
    user = db.get_user(user_id)
    
    if not user:
        return
    
    # Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
    username = user[1] or "Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…"
    level = user[3]
    xp = user[4]
    power = user[5]
    zone_coin = user[6]
    zone_gem = user[7]
    defense_level = user[8]
    cyber_level = user[9]
    miner_level = user[10]
    
    # Ù…Ø­Ø§Ø³Ø¨Ù‡ XP Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø³Ø·Ø­ Ø¨Ø¹Ø¯ÛŒ
    xp_needed = level * 100
    
    await message.answer(
        f"ğŸ‘¤ **Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±**\n\n"
        f"ğŸ†” Ù†Ø§Ù…: {username}\n"
        f"â­ Ø³Ø·Ø­: {level}\n"
        f"ğŸ“Š XP: {xp}/{xp_needed}\n"
        f"ğŸ’ª Ù‚Ø¯Ø±Øª: {power}\n"
        f"ğŸ’° ZP: {zone_coin:,}\n"
        f"ğŸ’ Ø¬Ù…: {zone_gem}\n"
        f"ğŸ›¡ï¸ Ù¾Ø¯Ø§ÙÙ†Ø¯: Ø³Ø·Ø­ {defense_level}\n"
        f"ğŸ”’ Ø§Ù…Ù†ÛŒØª: Ø³Ø·Ø­ {cyber_level}\n"
        f"â› Ù…Ø§ÛŒÙ†Ø±: Ø³Ø·Ø­ {miner_level}\n\n"
        f"ğŸ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ø² Ù…Ù†ÙˆÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯",
        reply_markup=profile_main_keyboard()
    )
